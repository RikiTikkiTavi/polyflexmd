#!/bin/bash

#SBATCH --job-name="{{ simulation.job.name }}"
#SBATCH --output="{{ simulation.job.logs_path }}/slurm-%j.out"
#SBATCH --error="{{ simulation.job.logs_path }}/slurm-%j.out"
#SBATCH --account="{{ simulation.job.account }}"
#SBATCH --time={{ simulation.job.time }}
#SBATCH --partition={{ simulation.job.partition }}
#SBATCH --ntasks={{ simulation.job.ntasks }}
#SBATCH --cpus-per-task={{ simulation.job.cpus_per_task }}
#SBATCH --mem-per-cpu={{ simulation.job.mem_per_cpu }}

module purge
module load modenv/hiera GCC/9.3.0 OpenMPI/4.0.3 LAMMPS/3Mar2020-Python-3.8.2-kokkos

export OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK

srun lmp \
  -in {{ simulation.lammps_input_path }} \
  -log {{ simulation.logs_path }}/log.txt {% if not simulation.variables.items().empty %}\{% endif %}{% for var_name, var_value in simulation.variables.items() %}
  -var {{ var_name }} {{ var_value }} {% if not loop.last %}\{% endif %}{% endfor %}